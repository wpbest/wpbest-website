<main class="main-container">
  <div class="chat-area">
    @for (message of chatMessages(); track $index) {
    <div
      class="chat-bubble"
      [class.user]="message.type === 'user'"
      [class.assistant]="message.type === 'assistant'"
      [innerHTML]="message.text | markdown"
    ></div>
    } @if (isTyping()) {
    <div class="chat-bubble assistant typing-indicator">
      <span></span><span></span><span></span>
    </div>
    }
  </div>

  <div class="input-controls">
    @if (currentMode() === UIMode.Default) {
    <div class="title">What can I help with?</div>
    <div class="input-bar">
      <button class="icon-button attachment-button" title="Add files and more">
        <mat-icon>attach_file</mat-icon>
      </button>
      <input
        type="text"
        placeholder="Ask anything"
        [(ngModel)]="inputText"
        class="text-input"
        (keydown.enter)="sendMessage()"
      />
      <button class="icon-button mic-button" (click)="startDictateMode()" title="Dictate">
        <mat-icon>mic</mat-icon>
      </button>
      <button
        class="icon-button voice-wave-button"
        (click)="toggleVoiceMode()"
        title="Use voice mode"
      >
        <mat-icon>graphic_eq</mat-icon>
      </button>
      <button class="icon-button send-button" (click)="sendMessage()" title="Send">
        <mat-icon>send</mat-icon>
      </button>
      <!-- <button class="icon-button test-button" (click)="testCode()" title="Test">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M16 1H8C6.34315 1 5 2.34315 5 4V20C5 21.6569 6.34315 23 8 23H16C17.6569 23 19 21.6569 19 20V4C19 2.34315 17.6569 1 16 1Z"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
          <path
            d="M10 9L14 13L18 9"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
          <path
            d="M9 5H15"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </button> -->
    </div>
    } @else if (currentMode() === UIMode.Dictate) {
    <div class="input-bar dictate-mode">
      <input type="text" [(ngModel)]="inputText" class="text-input" readonly />
      <button class="icon-button" (click)="acceptDictation()" title="Accept">
        <mat-icon>check</mat-icon>
      </button>
      <button class="icon-button" (click)="cancelDictation()" title="Cancel">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    } @else if (currentMode() === UIMode.Voice) {
    <div class="voice-mode-display">
      <div class="voice-mic-container">
        <div class="pulsing-circle"></div>
        <div class="progress-ring"></div>
        <div class="voice-controls">
          <button class="icon-button" (click)="toggleMicMute()">
            <mat-icon>{{ isMicMuted() ? 'mic_off' : 'mic' }}</mat-icon>
          </button>
          <button class="icon-button" (click)="cancelVoiceMode()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>
      <div class="voice-status">@if (isMicMuted()) { Microphone Muted } @else { Listening... }</div>
    </div>
    }
  </div>
</main>
